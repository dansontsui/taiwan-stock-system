# 選項5 vs 選項5a 完整比較說明

## 🎯 功能概述

現在**選項5a的CSV輸出已經包含了選項5的所有計算結果**，讓您可以在一次執行中同時獲得兩種投資方式的完整比較！

## 📊 兩種計算方式對比

| 項目 | 選項5 (等權重回測) | 選項5a (每月定期定額) |
|------|-------------------|---------------------|
| **投資方式** | 等權重配置 | 每月固定金額平均分配 |
| **交易成本** | ❌ 未計入 | ✅ 完整計入 |
| **報酬計算** | 毛報酬率 | 淨報酬率 |
| **資金管理** | 理論等權重 | 實際可購買股數 |
| **適用場景** | 策略回測 | 實際投資模擬 |

## 📁 選項5a的CSV輸出檔案

執行選項5a後，會在 `results/holdout_results/` 目錄下生成以下檔案：

### 1. 📄 `monthly_investment_trades_YYYYMMDD_HHMMSS.csv`
**完整交易記錄（包含兩種計算方式）**

#### 選項5的欄位（等權重，無交易成本）
- `actual_return_gross`: 毛報酬率
- `profit_loss_gross`: 毛損益
- `max_return_20d`: 20日最大報酬
- `min_return_20d`: 20日最小報酬

#### 選項5a的欄位（定期定額，含交易成本）
- `shares`: 實際購買股數
- `investment_amount`: 實際投資金額
- `month_end_value`: 月底價值
- `actual_return_net`: 淨報酬率
- `profit_loss_net`: 淨損益
- `transaction_costs`: 詳細交易成本
- `cost_impact`: 交易成本影響

#### 共同欄位
- `entry_date`, `stock_id`, `model_type`, `predicted_return`
- `entry_price`, `exit_date`, `exit_price`, `holding_days`

### 2. 📄 `monthly_summary_YYYYMMDD_HHMMSS.csv`
**每月投資摘要**
- 月份、入選股票、投資金額、月底價值、月報酬率等

### 3. 📄 `cost_impact_analysis_YYYYMMDD_HHMMSS.csv`
**交易成本影響分析**
- 毛報酬 vs 淨報酬的詳細比較
- 每筆交易的成本影響分析

### 4. 📄 `monthly_investment_results_YYYYMMDD_HHMMSS.json`
**整體績效JSON檔案**
- 完整的投資組合績效指標

## 💰 實際範例比較

### 交易成本影響分析
```
股票   毛報酬   淨報酬   成本影響   投資額     成本金額
2330   4.00%   3.27%   0.73%    500,000   3,524
2317   2.00%   1.27%   0.73%    300,000   2,114  
2454  -1.00%  -1.73%   0.73%    200,000   1,409
----------------------------------------------------
平均   2.40%   1.67%   0.73%  1,000,000   7,047
```

### 關鍵發現
- **交易成本平均影響**: 約0.73%的報酬率
- **成本金額**: 每100萬投資約7,000元成本
- **淨報酬**: 比毛報酬低約30%（2.40% → 1.67%）

## 🔍 如何使用

### 1. 執行選項5a
```bash
python stock_price_investment_system/start.py
# 選擇 5a) 執行每月定期定額投資回測（含交易成本）
```

### 2. 查看結果
- **主要交易記錄**: `monthly_investment_trades_*.csv`
- **成本影響分析**: `cost_impact_analysis_*.csv`
- **每月摘要**: `monthly_summary_*.csv`

### 3. 分析重點
- 比較 `actual_return_gross` vs `actual_return_net`
- 觀察 `cost_impact` 對不同股票的影響
- 分析 `transaction_costs` 的詳細構成

## 💡 分析建議

### 📈 績效分析
1. **毛報酬 vs 淨報酬**: 了解交易成本的真實影響
2. **成本敏感性**: 觀察不同股價股票的成本差異
3. **投資效率**: 評估定期定額 vs 等權重的差異

### 🎯 投資決策
1. **成本控制**: 選擇交易成本較低的股票
2. **投資頻率**: 考慮降低交易頻率以減少成本
3. **資金配置**: 優化每月投資金額分配

### 📊 風險管理
1. **實際報酬**: 以淨報酬為準進行風險評估
2. **成本預算**: 將交易成本納入投資預算
3. **績效追蹤**: 定期檢視成本影響趨勢

## ✅ 總結

**選項5a現在完全包含了選項5的計算結果**，並且提供了更豐富的分析：

- ✅ **同時計算**: 毛報酬和淨報酬
- ✅ **完整比較**: 兩種投資方式的差異
- ✅ **詳細分析**: 交易成本的具體影響
- ✅ **實用性**: 更貼近實際投資情況
- ✅ **進度顯示**: 完整的執行進度條

**建議**: 直接使用選項5a，可以獲得最完整的回測分析結果！
