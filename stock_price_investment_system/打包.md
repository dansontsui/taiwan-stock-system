# 股票預測系統跨電腦遷移指南

## 📋 概述

本指南說明如何將A電腦上完成的選單9、3、4結果遷移到B電腦，以便在B電腦上執行選單5（外層回測）。

## 🎯 重要發現：系統不保存AI模型檔案

### 系統設計特點
- ❌ **不保存模型檔案**：沒有 .pkl 或 .joblib 檔案
- ✅ **只保存最佳參數**：存在 `tuned_stocks_registry.csv` 中
- ✅ **動態模型創建**：每次執行時根據最佳參數即時訓練模型

### 為什麼這樣設計？
1. **節省空間**：不需要儲存大量模型檔案
2. **保持新鮮**：每次都用最新資料訓練
3. **參數化**：只需要參數就能重建相同模型

## 📁 需要遷移的檔案

### 必須複製的3個資料夾

#### 1. 超參數調優結果（選單9）
```
stock_price_investment_system/models/hyperparameter_tuning/
├── tuned_stocks_registry.csv                    ← 🔑 最重要！包含所有最佳參數
├── tuning_1101_20250821_102846.json            ← 各股票調優詳細結果
├── tuning_1101_20250821_102846.csv
├── tuning_1102_20250821_102904.json
└── ... (所有調優檔案)
```

#### 2. Walk-Forward驗證結果（選單3）
```
stock_price_investment_system/results/walk_forward/
├── walk_forward_results_20250825_143022.json   ← 🔑 選單4需要讀取
├── walk_forward_results_20250825_143022.csv    ← 交易明細
└── ... (其他結果檔案)
```

#### 3. 候選池結果（選單4）
```
stock_price_investment_system/results/candidate_pools/
├── candidate_pool_20250825_082346.json         ← 🔑 選單5需要讀取
├── candidate_pool_20250825_082346.csv
└── ... (其他候選池檔案)
```

## 🚀 自動化遷移工具

### 使用 migrate_to_another_pc.py

#### A電腦（來源電腦）
```bash
# 1. 執行遷移工具
python migrate_to_another_pc.py

# 2. 選擇選項 1（創建遷移包）
選擇操作: 1

# 3. 工具會自動：
#    - 複製所有必要檔案
#    - 創建時間戳記資料夾
#    - 打包成ZIP檔案
#    - 生成說明文件

# 4. 產生檔案：
stock_migration_20250825_143022.zip  ← 遷移包
```

#### B電腦（目標電腦）
```bash
# 1. 將ZIP檔案複製到B電腦

# 2. 解壓ZIP檔案
unzip stock_migration_20250825_143022.zip

# 3. 執行還原
python migrate_to_another_pc.py

# 4. 選擇選項 2（還原遷移包）
選擇操作: 2
輸入遷移包路徑: stock_migration_20250825_143022

# 5. 工具會自動還原所有檔案到正確位置
```

## 📋 手動遷移步驟

### A電腦（打包）
```bash
# 1. 創建遷移資料夾
mkdir stock_migration_manual

# 2. 複製必要檔案
cp -r stock_price_investment_system/models/hyperparameter_tuning/ stock_migration_manual/
cp -r stock_price_investment_system/results/walk_forward/ stock_migration_manual/
cp -r stock_price_investment_system/results/candidate_pools/ stock_migration_manual/

# 3. 打包
tar -czf stock_migration_manual.tar.gz stock_migration_manual/
```

### B電腦（還原）
```bash
# 1. 解壓遷移包
tar -xzf stock_migration_manual.tar.gz

# 2. 還原檔案
cp -r stock_migration_manual/hyperparameter_tuning/ stock_price_investment_system/models/
cp -r stock_migration_manual/walk_forward/ stock_price_investment_system/results/
cp -r stock_migration_manual/candidate_pools/ stock_price_investment_system/results/

# 3. 確保資料夾結構
mkdir -p stock_price_investment_system/results/holdout/
```

## ✅ 遷移驗證

### B電腦上的檢查清單

#### 1. 檢查檔案是否存在
```bash
# 檢查超參數調優記錄
ls stock_price_investment_system/models/hyperparameter_tuning/tuned_stocks_registry.csv

# 檢查Walk-Forward結果
ls stock_price_investment_system/results/walk_forward/*.json

# 檢查候選池
ls stock_price_investment_system/results/candidate_pools/*.json
```

#### 2. 測試系統功能
```bash
# 啟動系統
python stock_price_investment_system/start.py

# 選擇選單5，應該能正常執行
# 如果出現錯誤，檢查資料庫連線和資料完整性
```

## ⚠️ B電腦的前提條件

### 必須具備
1. **相同的股價資料庫**
   - 包含到相同日期的股價資料
   - 資料庫連線設定正確

2. **相同的Python環境**
   - Python版本一致
   - 套件版本一致（requirements.txt）

3. **正確的系統配置**
   - config/settings.py 設定正確
   - 資料夾權限正確

### 資料庫同步
```bash
# 確保B電腦的資料庫包含最新資料
# 資料更新到與A電腦相同的日期
# 特別是2025年1-7月的資料（用於外層回測）
```

## 🎯 執行流程

### 完整的跨電腦執行流程

#### A電腦
1. ✅ 選單9：超參數調優
2. ✅ 選單3：內層walk-forward驗證
3. ✅ 選單4：生成候選池
4. ✅ 打包遷移：`python migrate_to_another_pc.py`

#### B電腦
1. ✅ 還原遷移包：`python migrate_to_another_pc.py`
2. ✅ 選單5：外層回測（2025年1-7月）
3. ✅ 選單2：預測8月股票（可選）

## 💡 系統運作原理

### 選單5執行時的流程
```python
# 1. 讀取候選池
candidate_pool = load_json("candidate_pools/latest.json")

# 2. 讀取最佳參數
best_params = load_csv("hyperparameter_tuning/tuned_stocks_registry.csv")

# 3. 為每檔股票創建預測器
for stock_id in candidate_pool:
    params = get_best_params(stock_id)
    predictor = StockPricePredictor(
        model_type=params['model_type'],
        **params['parameters']
    )
    
    # 4. 用B電腦的最新資料即時訓練
    predictor.train(latest_data)
    
    # 5. 進行預測和回測
    predictions = predictor.predict(stock_id, date)
```

## 🔧 故障排除

### 常見問題

#### 1. 找不到檔案
```
錯誤：找不到 walk-forward 驗證結果檔案
解決：檢查 results/walk_forward/ 資料夾是否存在且有 .json 檔案
```

#### 2. 候選池為空
```
錯誤：候選池為空，無法執行回測
解決：檢查 results/candidate_pools/ 資料夾是否有最新的 .json 檔案
```

#### 3. 沒有調優記錄
```
錯誤：沒有找到超參數調優記錄
解決：檢查 models/hyperparameter_tuning/tuned_stocks_registry.csv 是否存在
```

### 檢查工具
```bash
# 檢查遷移包完整性
python -c "
import json
from pathlib import Path

# 檢查關鍵檔案
files_to_check = [
    'stock_price_investment_system/models/hyperparameter_tuning/tuned_stocks_registry.csv',
    'stock_price_investment_system/results/walk_forward/',
    'stock_price_investment_system/results/candidate_pools/'
]

for file_path in files_to_check:
    path = Path(file_path)
    if path.exists():
        if path.is_file():
            print(f'✅ {file_path}')
        else:
            count = len(list(path.glob('*.json')))
            print(f'✅ {file_path} ({count} files)')
    else:
        print(f'❌ {file_path}')
"
```

## 📊 檔案大小估算

### 典型遷移包大小
- **超參數調優結果**：~50-100MB（取決於股票數量）
- **Walk-Forward結果**：~10-50MB（取決於時間範圍）
- **候選池結果**：~1-5MB
- **總計**：約100-200MB

### 壓縮效果
- ZIP壓縮後約為原大小的30-50%
- 最終遷移包約50-100MB

---

## 🎉 總結

通過這個遷移指南，您可以：
1. ✅ 輕鬆將A電腦的訓練結果遷移到B電腦
2. ✅ 無需重新執行耗時的選單9、3、4
3. ✅ 在B電腦上直接執行選單5進行2025年回測
4. ✅ 使用自動化工具簡化遷移過程

**關鍵優勢**：系統的參數化設計讓跨電腦遷移變得簡單高效！
