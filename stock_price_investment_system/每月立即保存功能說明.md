# 選項5a 每月立即保存功能說明

## 🎯 功能概述

**好消息！** 選項5a現在已經具備與選項5**完全相同**的每月立即保存功能！

每當處理完一個月的投資後，系統會**立即保存**該月的詳細結果到CSV檔案，讓您可以即時追蹤投資進度。

## 📅 立即保存機制

### 觸發時機
選項5a會在以下情況**立即保存**月度結果：

1. ✅ **正常交易完成**：成功投資並計算報酬後
2. ⚠️ **市場濾網觸發**：技術面條件不符，暫停投資
3. ❌ **無符合條件股票**：沒有股票通過篩選條件

### 保存位置
```
stock_price_investment_system/results/holdout/
└── holdout_YYYYMM_YYYYMM_XXX_kXX_XX_TIMESTAMP/
    ├── holdout_monthly_SESSION_20230131.csv  # 2023年1月結果
    ├── holdout_monthly_SESSION_20230228.csv  # 2023年2月結果
    ├── holdout_monthly_SESSION_20230331.csv  # 2023年3月結果
    └── ...
```

## 📄 檔案命名格式

### 命名規則
```
holdout_monthly_{會話ID}_{年月日}.csv
```

### 實際範例
```
holdout_monthly_20250827_143022_20230131.csv
holdout_monthly_20250827_143022_20230228.csv
holdout_monthly_20250827_143022_20230331.csv
```

- `20250827_143022`: 會話ID（執行時間戳）
- `20230131`: 該月最後一天（2023年1月31日）

## 📊 CSV檔案內容

### 摘要資訊區塊
```csv
項目,數值
月份,2023-01
市場濾網觸發,False
入選股票數,3
入選股票,"2330, 2317, 2454"
投資金額,"1,000,000"
月底價值,"1,050,000"
月報酬率,5.00%
交易數,3
保存時間,2025-08-27 14:30:22
會話ID,20250827_143022
```

### 交易詳情區塊
```csv
交易詳情
進場日,股票代號,模型,預測報酬,股數,投資金額,進場價,出場日,出場價,毛報酬,淨報酬,持有天數,毛損益,淨損益,月底價值,交易成本
2023-01-31,2330,XGBoost,5.00%,"1,000","500,000",500.00,2023-02-28,520.00,4.00%,3.27%,20,"20,000","16,350","520,000","3,650"
2023-01-31,2317,LightGBM,3.00%,"3,000","300,000",100.00,2023-02-28,102.00,2.00%,1.27%,20,"6,000","3,810","306,000","2,190"
2023-01-31,2454,RandomForest,2.50%,"1,000","200,000",200.00,2023-02-28,205.00,2.50%,1.77%,20,"5,000","3,540","205,000","1,460"
```

## 🔍 與選項5的比較

### 相同點
| 功能 | 選項5 | 選項5a |
|------|-------|--------|
| **立即保存** | ✅ | ✅ |
| **檔案命名** | `holdout_monthly_*` | `holdout_monthly_*` |
| **保存位置** | 相同參數化資料夾 | 相同參數化資料夾 |
| **摘要資訊** | ✅ | ✅ |
| **交易詳情** | ✅ | ✅ |

### 差異點
| 內容 | 選項5 | 選項5a |
|------|-------|--------|
| **報酬計算** | 只有毛報酬 | 毛報酬 + 淨報酬 |
| **投資資訊** | 等權重 | 股數 + 投資金額 |
| **交易成本** | 無 | 詳細成本資訊 |
| **額外欄位** | 基本欄位 | 月底價值、成本分析 |

## 💡 實際使用範例

### 執行過程中的日誌
```
💰 進度 [ 1/6] [███░░░░░░░░░░░░░░░░░]  16.7% - 處理 2023-01
   📊 訓練模型中...
   💼 執行交易中...
💾 2023-01 結果已保存至: holdout_monthly_20250827_143022_20230131.csv
✅ 2023-01: 投資 1,000,000 元，月底價值 1,050,000 元，報酬率 5.00%

💰 進度 [ 2/6] [██████░░░░░░░░░░░░░░]  33.3% - 處理 2023-02
⚠️  市場濾網觸發，跳過 2023-02
💾 2023-02 結果已保存至: holdout_monthly_20250827_143022_20230228.csv

💰 進度 [ 3/6] [██████████░░░░░░░░░░]  50.0% - 處理 2023-03
❌ 2023-03: 無符合條件的股票
💾 2023-03 結果已保存至: holdout_monthly_20250827_143022_20230331.csv
```

### 檔案產生時機
```
📁 回測進行中的檔案結構:
holdout_202301_202306_020_k10_MF_20250827_143022/
├── holdout_monthly_20250827_143022_20230131.csv  ✅ 1月完成後立即產生
├── holdout_monthly_20250827_143022_20230228.csv  ✅ 2月完成後立即產生
├── holdout_monthly_20250827_143022_20230331.csv  ✅ 3月完成後立即產生
├── ... (其他月份陸續產生)
└── holdout_20250827_143022.json                  ✅ 全部完成後產生
```

## 🚀 使用優勢

### 1. **即時監控**
- ✅ 不用等全部完成就能看到進度
- ✅ 每月結果立即可見
- ✅ 可以提前發現問題

### 2. **風險控制**
- ✅ 如果程式中斷，已處理的月份不會丟失
- ✅ 可以從中斷點繼續分析
- ✅ 部分結果也有參考價值

### 3. **分析便利**
- ✅ 可以單獨分析特定月份
- ✅ 比較不同月份的表現
- ✅ 追蹤投資策略的演變

### 4. **完整記錄**
- ✅ 包含毛報酬和淨報酬
- ✅ 詳細的交易成本資訊
- ✅ 市場濾網和篩選條件的影響

## 📈 分析建議

### 即時追蹤
1. **定期檢查**：每處理幾個月就檢查一次結果
2. **趨勢觀察**：注意月報酬率的變化趨勢
3. **成本分析**：觀察交易成本對不同月份的影響

### 問題診斷
1. **市場濾網**：統計濾網觸發的頻率和時機
2. **股票篩選**：分析無符合條件股票的原因
3. **報酬分析**：比較毛報酬和淨報酬的差異

## ✅ 總結

**選項5a現在完全具備與選項5相同的每月立即保存功能**，並且提供更豐富的資訊：

- ✅ **相同的保存機制**：每月處理完立即保存
- ✅ **相同的檔案位置**：統一的目錄結構
- ✅ **相同的命名格式**：便於管理和比較
- ➕ **更豐富的內容**：毛報酬、淨報酬、交易成本
- ➕ **更詳細的分析**：投資金額、股數、月底價值

**現在您可以即時追蹤每月定期定額投資的詳細進度！** 🎉
