執行順序總覽（建議流程）
第一次建置或大變動後的完整順序：

參數調校與優化（股價模型）
AI 模型訓練（股價模型）
回測與模型評估（股價模型）【內層 walk-forward】
生成 candidate pool（內層統計套門檻）
執行外層 holdout 回測
每月例行更新（資料新增後）：

若當月分佈變化不大：5 → 7 → 10 → 11
若模型表現下降或資料分佈改變：6 → 5 → 7 → 10 → 11
說明：6 用來找「最佳超參數」，5 用來「用最佳參數正式訓練模型」，7 用「時間滾動視窗」評估穩健度（內層），10 依 7 的結果產生候選股票池，11 在「未見樣本」進行最終驗證（外層）。

各選項的功能意義與輸入/輸出
6) 參數調校與優化（股價模型）
    功能意義
    使用訓練期間資料，對股價模型（例如 XGBoost/LightGBM）進行超參數搜尋（如 learning_rate、max_depth、subsample 等）。
    目標是最小化誤差或最大化方向準確率/收益分數，找到「穩健」的超參數組合。
    何時執行
    首次建置、重大功能變更、或觀察到近期回測績效下滑時。
    輸入
    訓練期的特徵資料（營收特徵、技術指標、因子）與目標（未來1/3月報酬或方向）。
    輸出（範例）
    best_params.json（股價模型用；以股票或全域為鍵）
    調校紀錄 CSV/HTML（測試過的參數與指標）
    注意
    參數調校只在訓練期內進行，避免洩漏未來資訊。
5) AI 模型訓練（股價模型）
    功能意義
    用 6) 的最佳參數，在訓練期間資料上正式訓練模型，產出可用的「已訓練模型檔」。
    何時執行
    在 6) 完成之後，或已經有穩定 best_params 時。
    輸入
    訓練期資料、best_params.json。
    輸出（範例）
    models/{stock_id}/{model_name}.bin（或全域模型）、
    訓練摘要報表（指標、特徵重要度）。
    注意
    訓練出的模型會在之後 7/10/11 階段被使用與驗證。
7) 回測與模型評估（股價模型）【內層 walk-forward】
    功能意義
    以訓練期內做「巢狀/滾動」驗證（例如 W_train=48 月、W_test=12 月、stride=12），評估模型穩健度。
    每個 fold 都是「先訓練後測試」，模擬真實月度投資流程（含交易成本與日級執行規則）。
    輸入
    已訓練模型（或每 fold 內重新訓練）、訓練期資料範圍與參數（W_train/W_test/stride）。
    輸出（範例）
    每 fold 的績效（勝率、盈虧比、最大回撤、平均持有期、交易次數）
    每檔股票在多個 fold 的統計聚合（median/分位數）
    回測報表（HTML/CSV；中文圖表與說明）
    注意
    這一步的輸出將作為 10) 生成 candidate pool 的依據。
10) 生成 candidate pool（內層統計套門檻）
    功能意義
    用 7) 的多 fold 統計，對每檔股票做「跨 fold 聚合」得到 stock-score，依門檻（如 勝率 median ≥ 52%、盈虧比 median ≥ 1.2）篩出「模型友善」股票池，避免在外層用到不穩定標的。
    輸入
    內層回測的 per-stock 統計（聚合後）。
    輸出（範例）
    candidate_pool.csv（含股票代碼、stock-score、入池原因說明）
    注意
    門檻可參數化；可依產業或風控條件做額外限制（如產業曝險）。
11) 執行外層 holdout 回測
    功能意義
    將內層「凍結」的模型架構/超參數與 candidate pool，帶到未見樣本（例如 2023–2024）做最終驗證，檢驗真實可行性與避免過擬合。
    僅對 candidate pool 進行交易，並計入成本/滑價，在日級行情上模擬執行。
    輸入
    凍結模型、candidate_pool.csv、holdout 期間資料（未在訓練期使用）。
    輸出（範例）
    組合績效報告（年化報酬、波動度、夏普、最大回撤）
    NAV 曲線（HTML/CSV；中文）
    交易紀錄 CSV（含手續、滑價、淨利）
    注意
    外層失敗代表模型需要調整（特徵、參數、門檻、成本假設、執行規則等）。
為什麼順序是「6 → 5 → 7 → 10 → 11」
    6（調校）決定「如何訓練」；5（訓練）將「最佳參數」產出可用模型
    7（內層）驗證「在訓練期內，不偷看未來」的可重現性與穩健性
    10 用 7 的結果「鎖定」更有機會成功的股票池
    11 才能在未見樣本做真正的「上線前驗證」，降低部署風險
    實務建議（小抄）
    第一次上線或大改版
    6 → 5 → 7 → 10 → 11（看外層結果）
每月資料更新後
    快速管道：5 → 7 → 10 → 11
    若績效下降或市場變化明顯：6 → 5 → 7 → 10 → 11
    成本/滑價請務必納入，若無法合理估計，寧可上調成本做保守評估
    執行規則以「每月信號、第一個可交易日執行、日級模擬」為準則
    執行方式（示意）
互動選單：
python stock_price_investment_system/start.py
依序選：6 → 5 → 7 → 10 → 11
自動化（未來 orchestrator 會做）
檢測新月份資料 → 自動觸發（中文日誌）
自動寫入 Project_status.md（中文）
自動 git commit/push（中文摘要）
