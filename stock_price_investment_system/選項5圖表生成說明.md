# 選項5 圖表生成功能說明

## 🎯 功能概述

**完成！** 選項5（每月定期定額投資回測）現在具備與選項aa（外層回測）**完全相同**的圖表生成功能！

## 📊 圖表生成功能

### 自動生成的圖表
選項5會在回測完成後自動生成以下4種圖表：

1. **📈 淨值曲線圖** (`nav_curve_*.png`)
   - 累積報酬曲線
   - 回撤分析
   - 使用淨報酬計算

2. **📊 月度報酬分布** (`monthly_returns_*.png`)
   - 月度報酬柱狀圖
   - 報酬率分布直方圖
   - 基於淨報酬統計

3. **📋 交易統計圖** (`trade_statistics_*.png`)
   - 勝率統計
   - 平均獲利/虧損
   - 交易次數分布
   - 持有天數分析

4. **🏢 個股表現圖** (`stock_performance_*.png`)
   - 個股報酬率排名
   - 預測vs實際報酬散點圖
   - 個股交易統計

## 📁 輸出結構

### 完整的檔案結構
```
📁 holdout_202301_202306_020_k10_MF_20250827_143022/
├── 📄 holdout_monthly_20250827_143022_YYYYMMDD.csv  # 每月報告
├── 📄 holdout_20250827_143022.json                 # 最終結果JSON
├── 📄 holdout_trades_20250827_143022.csv           # 交易記錄CSV
├── 📄 monthly_summary_20250827_143022.csv          # 每月摘要
├── 📄 cost_impact_analysis_20250827_143022.csv     # 成本分析
└── 📁 charts/                                      # 圖表目錄
    ├── 📊 nav_curve_20250827_143022.png            # 淨值曲線
    ├── 📊 monthly_returns_20250827_143022.png      # 月度報酬
    ├── 📊 trade_statistics_20250827_143022.png     # 交易統計
    └── 📊 stock_performance_20250827_143022.png    # 個股表現
```

### 與選項aa的一致性
| 項目 | 選項aa | 選項5 |
|------|--------|-------|
| **圖表數量** | 4個 | 4個 ✅ |
| **圖表類型** | 相同 | 相同 ✅ |
| **輸出位置** | charts/子目錄 | charts/子目錄 ✅ |
| **檔案命名** | 相同格式 | 相同格式 ✅ |
| **圖表品質** | 高解析度PNG | 高解析度PNG ✅ |

## 📈 圖表資料來源

### 主要報酬率
選項5的圖表使用**淨報酬率**作為主要資料來源：

```python
# 圖表生成使用的欄位
'actual_return': 0.0327,      # 淨報酬率（扣除交易成本）
'profit_loss': 16350.0        # 淨損益（扣除交易成本）
```

### 資料完整性
選項5提供比選項aa更豐富的資料：

#### 基本欄位（與選項aa相同）
- `entry_date`: 進場日期
- `stock_id`: 股票代號  
- `actual_return`: 實際報酬率
- `predicted_return`: 預測報酬率

#### 額外欄位（選項5專屬）
- `actual_return_gross`: 毛報酬率
- `actual_return_net`: 淨報酬率
- `profit_loss_gross`: 毛損益
- `profit_loss_net`: 淨損益
- `shares`: 實際股數
- `investment_amount`: 投資金額
- `transaction_costs`: 交易成本詳情
- `cost_impact`: 成本影響分析

## 🔍 圖表特色

### 1. 真實投資模擬
- ✅ 基於實際交易成本的淨報酬
- ✅ 考慮滑價、手續費、證交稅
- ✅ 反映真實投資績效

### 2. 詳細成本分析
- ✅ 毛報酬vs淨報酬比較
- ✅ 交易成本對績效的影響
- ✅ 成本效率分析

### 3. 定期定額特色
- ✅ 每月固定投資金額
- ✅ 實際可購買股數
- ✅ 月度投資績效追蹤

### 4. 視覺化品質
- ✅ 中文字體支援
- ✅ 高解析度PNG格式
- ✅ 專業的圖表設計
- ✅ 清晰的標籤和圖例

## 🚀 使用方式

### 執行選項5
```bash
python stock_price_investment_system/start.py
# 選擇 5) 執行每月定期定額投資回測（含交易成本）
```

### 查看圖表
1. 回測完成後，進入結果目錄
2. 打開 `charts/` 子目錄
3. 查看4個PNG圖表檔案

### 圖表解讀
- **淨值曲線**：觀察累積報酬趨勢和回撤
- **月度報酬**：分析月度績效分布
- **交易統計**：了解勝率和平均報酬
- **個股表現**：識別表現最佳的股票

## 💡 分析建議

### 績效評估
1. **淨值曲線**：關注長期趨勢和最大回撤
2. **月度分布**：檢查報酬率的穩定性
3. **勝率統計**：評估策略的可靠性
4. **個股分析**：識別優質標的

### 成本影響
1. **比較毛淨報酬**：了解交易成本的實際影響
2. **成本效率**：評估交易頻率的合理性
3. **優化建議**：調整投資策略降低成本

### 投資決策
1. **風險評估**：基於真實淨報酬進行風險分析
2. **資金配置**：參考個股表現調整配置
3. **策略優化**：根據圖表結果改進策略

## ✅ 總結

**選項5現在提供完整的圖表生成功能**：

- ✅ **4種專業圖表**：淨值曲線、月度報酬、交易統計、個股表現
- ✅ **真實資料基礎**：使用扣除交易成本的淨報酬
- ✅ **統一輸出位置**：charts/子目錄，與選項aa一致
- ✅ **豐富資料內容**：同時提供毛報酬和淨報酬資訊
- ✅ **專業視覺化**：高品質PNG圖表，支援中文顯示

**現在選項5提供了最完整的每月定期定額投資回測體驗，包含詳細的視覺化分析！** 🎉
