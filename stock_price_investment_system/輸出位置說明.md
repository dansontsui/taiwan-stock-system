# 選項5 vs 選項5a 輸出位置說明

## 📁 輸出位置統一

**好消息！** 選項5a現在已經與選項5使用**完全相同的輸出位置**！

## 🗂️ 輸出目錄結構

### 基礎路徑
```
stock_price_investment_system/results/holdout/
```

### 參數化資料夾命名規則
```
holdout_{開始年月}_{結束年月}_{門檻}_{TopK}_{市場濾網}_{時間戳}
```

**範例**：
```
holdout_202301_202306_020_k10_MF_0827094316
```
- `202301`: 開始日期 2023-01
- `202306`: 結束日期 2023-06  
- `020`: 預測門檻 2.0%
- `k10`: TopK = 10檔股票
- `MF`: 市場濾網啟用 (Market Filter)
- `0827094316`: 執行時間戳

## 📄 檔案輸出對比

### 選項5 (等權重回測) 輸出檔案
```
📁 holdout_YYYYMM_YYYYMM_XXX_kXX_XX_TIMESTAMP/
├── 📄 holdout_TIMESTAMP.json          # 主要結果JSON
├── 📄 holdout_trades_TIMESTAMP.csv    # 交易記錄CSV
├── 📄 holdout_monthly_SESSION_DATE.csv # 每月詳細記錄
└── 📁 charts/                         # 圖表目錄
    ├── nav_curve_TIMESTAMP.png
    ├── monthly_returns_TIMESTAMP.png
    ├── trade_statistics_TIMESTAMP.png
    └── stock_performance_TIMESTAMP.png
```

### 選項5a (每月定期定額) 輸出檔案
```
📁 holdout_YYYYMM_YYYYMM_XXX_kXX_XX_TIMESTAMP/
├── 📄 holdout_TIMESTAMP.json              # 主要結果JSON (與選項5相同命名)
├── 📄 holdout_trades_TIMESTAMP.csv        # 交易記錄CSV (與選項5相同命名，但包含更多欄位)
├── 📄 monthly_summary_TIMESTAMP.csv       # 每月投資摘要 (新增)
└── 📄 cost_impact_analysis_TIMESTAMP.csv  # 交易成本影響分析 (新增)
```

## 🔍 檔案內容差異

### 📄 `holdout_trades_TIMESTAMP.csv` 比較

#### 選項5的欄位
```csv
entry_date, stock_id, model_type, predicted_return,
entry_price, exit_date, exit_price, actual_return,
holding_days, profit_loss, max_return_20d, min_return_20d
```

#### 選項5a的欄位 (包含選項5的所有欄位 + 額外欄位)
```csv
# 基本資訊 (與選項5相同)
entry_date, stock_id, model_type, predicted_return,
entry_price, exit_date, exit_price, holding_days,

# 選項5的計算結果 (等權重，無交易成本)
actual_return_gross, profit_loss_gross, max_return_20d, min_return_20d,

# 選項5a的計算結果 (定期定額，含交易成本)
shares, investment_amount, month_end_value,
actual_return_net, profit_loss_net, transaction_costs,

# 成本影響分析
cost_impact
```

### 📄 新增的分析檔案

#### `monthly_summary_TIMESTAMP.csv`
```csv
月份, 市場濾網觸發, 入選股票數, 入選股票,
投資金額, 月底價值, 月報酬率, 交易筆數
```

#### `cost_impact_analysis_TIMESTAMP.csv`
```csv
股票代號, 進場日期, 毛報酬率, 淨報酬率,
交易成本影響, 投資金額, 交易成本金額
```

## 🎯 實際範例

### 執行選項5a後的輸出
```
📁 完整路徑範例:
G:\WorkFolder\taiwan-stock-system\stock_price_investment_system\results\holdout\holdout_202301_202306_020_k10_MF_20250827_143022\

📄 產生的檔案:
├── holdout_20250827_143022.json              # 與選項5相同命名
├── holdout_trades_20250827_143022.csv        # 與選項5相同命名，但內容更豐富
├── monthly_summary_20250827_143022.csv       # 選項5a專屬
└── cost_impact_analysis_20250827_143022.csv  # 選項5a專屬
```

### 日誌輸出範例
```
💾 交易記錄CSV已保存: holdout_trades_20250827_143022.csv
💾 每月摘要CSV已保存: monthly_summary_20250827_143022.csv
💾 每月定期定額回測結果已保存: holdout_20250827_143022.json
💾 成本影響分析CSV已保存: cost_impact_analysis_20250827_143022.csv
📁 所有結果已保存至目錄: holdout_202301_202306_020_k10_MF_20250827_143022
📂 完整路徑: G:\WorkFolder\taiwan-stock-system\stock_price_investment_system\results\holdout\holdout_202301_202306_020_k10_MF_20250827_143022
```

## ✅ 統一的好處

### 1. **相同的組織結構**
- ✅ 所有回測結果都在同一個基礎目錄
- ✅ 使用相同的參數化資料夾命名
- ✅ 便於比較和管理

### 2. **檔案命名一致**
- ✅ 主要檔案 (`holdout_*.json`, `holdout_trades_*.csv`) 命名相同
- ✅ 可以直接替換使用
- ✅ 工具和腳本相容性更好

### 3. **內容向下相容**
- ✅ 選項5a的CSV包含選項5的所有欄位
- ✅ 可以用選項5a的結果進行選項5的分析
- ✅ 額外提供更詳細的成本分析

### 4. **便於比較分析**
- ✅ 同一個CSV檔案中可以比較毛報酬 vs 淨報酬
- ✅ 直接看到交易成本的影響
- ✅ 不需要額外的資料合併工作

## 💡 使用建議

### 查找結果檔案
1. 進入 `stock_price_investment_system/results/holdout/`
2. 找到對應參數的資料夾 (以 `holdout_` 開頭)
3. 查看資料夾內的檔案

### 主要分析檔案
- **`holdout_trades_*.csv`**: 最重要的交易記錄，包含所有計算結果
- **`cost_impact_analysis_*.csv`**: 專門分析交易成本影響
- **`monthly_summary_*.csv`**: 每月投資概況

### 快速對比
```bash
# 在同一個資料夾中，可以直接比較：
# - 毛報酬 (actual_return_gross) vs 淨報酬 (actual_return_net)
# - 成本影響 (cost_impact)
# - 實際投資金額 vs 理論等權重
```

**總結：選項5a現在完全使用與選項5相同的輸出位置，並且提供更豐富的分析內容！** 🎉
