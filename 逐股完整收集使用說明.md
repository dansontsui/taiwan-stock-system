# 逐股完整收集功能使用說明

## 功能概述

逐股完整收集功能讓您可以對每支股票進行完整的資料收集，包含所有階段的資料，然後再處理下一支股票。這種方式確保每支股票的資料都是完整的。

## 收集階段

每支股票會依序收集以下資料：

1. **基礎資料收集** - 股價、月營收、現金流
2. **財務報表資料收集** - 綜合損益表
3. **資產負債表資料收集** - 資產負債表、財務比率
4. **股利資料收集** - 股利政策、除權除息結果
5. **潛力股分析** - 股票評分、潛力股排名

## 模式說明

### 1. 測試模式 (stock-by-stock-test)

- **股票範圍**: 5檔知名股票 (2330, 2317, 2454, 2412, 6505)
- **互動方式**: 每檔股票處理完成後詢問是否繼續
- **適用場景**: 測試功能、學習流程、驗證設定
- **執行時間**: 約 10-30 分鐘

### 2. 自動執行模式 (stock-by-stock-auto)

- **股票範圍**: 資料庫中所有活躍股票 (約 2,391 檔)
- **互動方式**: 完全自動執行，不詢問
- **智能跳過**: 自動檢查資料完整性，跳過已完整的股票
- **適用場景**: 大批量資料收集、定期更新
- **執行時間**: 數小時到數天 (取決於網路速度和資料量)

## 使用方法

### 方法 1: 直接使用 c.py

```bash
# 測試模式
python c.py stock-by-stock-test

# 自動執行模式
python c.py stock-by-stock-auto
```

### 方法 2: 透過 start.py

```bash
# 測試模式
python start.py stock-by-stock-test

# 自動執行模式
python start.py stock-by-stock-auto
```

### 方法 3: 互動式選單

```bash
python start.py
```

然後選擇：
- 選項 10: 逐股完整收集 (測試模式)
- 選項 11: 逐股完整收集 (自動執行)

## 日誌記錄

### 日誌檔案

系統會自動生成帶時間戳的日誌檔案：
```
stock_by_stock_20250804_090555.log
```

### 記錄內容

- ✅ **處理進度**: 目前處理的股票和進度
- ⚠️ **資料缺失**: 只記錄資料不完整的股票
- ❌ **處理失敗**: 記錄失敗的股票和原因
- 📊 **統計資訊**: 成功率、跳過數量等

### 日誌範例

```
2025-08-04 09:05:55 - INFO - 開始逐股完整資料收集流程 - 自動執行模式
2025-08-04 09:05:55 - INFO - 處理 2391 檔股票
2025-08-04 09:06:01 - WARNING - 資料缺失 - 1101(台泥) 缺失: 股利政策資料, 潛力股分析 (完整度: 60.0%)
2025-08-04 09:06:15 - INFO - 股票 1101 完整收集成功
2025-08-04 09:06:20 - ERROR - 股票 1102 完整收集失敗
```

## 智能跳過機制

### 資料完整性檢查

系統會檢查以下資料表：
- stock_prices (股價資料)
- monthly_revenues (月營收資料)
- financial_statements (財務報表資料)
- dividend_policies (股利政策資料)
- stock_scores (潛力股分析)

### 跳過條件

在自動執行模式下，如果股票的所有資料表都有資料，系統會自動跳過該股票，避免重複收集。

## 成功標準

每支股票需要至少 3 個階段成功才算收集成功：
- 5/5 階段成功 = 完美
- 4/5 階段成功 = 優秀
- 3/5 階段成功 = 合格
- 2/5 階段成功 = 失敗

## 注意事項

### 執行前準備

1. **確保網路連線穩定**
2. **確保有足夠的磁碟空間** (建議至少 10GB)
3. **建議在非交易時間執行** (避免網站負載過高)

### 中斷處理

- **Ctrl+C**: 可以隨時中斷執行
- **測試模式**: 每檔股票後可選擇停止
- **自動模式**: 中斷後可重新執行，會跳過已完成的股票

### 效能建議

- **測試模式**: 適合在任何時間執行
- **自動模式**: 建議在夜間或週末執行
- **分批執行**: 可以多次執行自動模式，系統會智能跳過已完成的股票

## 故障排除

### 常見問題

1. **資料庫連接失敗**
   - 檢查 `data/taiwan_stock.db` 是否存在
   - 確保檔案沒有被其他程式鎖定

2. **網路連接問題**
   - 檢查網路連線
   - 稍後重試，系統會從中斷處繼續

3. **權限問題**
   - 確保有寫入日誌檔案的權限
   - 確保有讀取資料庫的權限

### 檢查結果

執行完成後可以使用以下命令檢查結果：

```bash
# 檢查個股資料完整性
python start.py check

# 查看日誌檔案
notepad stock_by_stock_*.log  # Windows
cat stock_by_stock_*.log      # Mac/Linux
```

## 總結

逐股完整收集功能提供了一個系統化的方式來收集台股資料，特別適合：

- 🧪 **初次建立資料庫**
- 🔄 **定期資料更新**
- 🎯 **確保資料完整性**
- 📊 **大批量資料處理**

建議先使用測試模式熟悉流程，確認無問題後再使用自動執行模式進行大批量處理。
