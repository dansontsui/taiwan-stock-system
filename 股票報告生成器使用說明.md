# 📊 股票財務分析報告生成器使用說明

## 🎯 功能概述

這個工具可以根據輸入的股票代號，自動生成完整的Excel財務分析報告，包含6個工作表的詳細分析。

## 📋 輸出內容

### 1. **基本資訊工作表**
- 股票代號、股票名稱、所屬市場（上市/上櫃）
- 產業別、上市日期、是否為ETF
- 最新股價、成交量、成交金額
- 本益比(PE)、股價淨值比(PB)、殖利率

### 2. **月營收工作表**
- 近24個月的月營收數據
- 包含：年月、營收金額、月增率(MoM)、年增率(YoY)
- 自動格式化千分位符號

### 3. **季度財務工作表**
- 近8季的綜合損益表數據
- 包含：營業收入、毛利、營業利益、稅後淨利、每股盈餘(EPS)
- 季度趨勢分析

### 4. **年度財務工作表**
- 近5年的年度財務數據
- 財務比率：ROE、ROA、毛利率、營業利益率、淨利率
- 資產負債表重要項目：總資產、股東權益、總負債

### 5. **股利政策工作表**
- 近5年的配息配股記錄
- 包含：現金股利、股票股利、除息日、除權日
- 配息穩定性分析

### 6. **潛力分析工作表**
- 系統計算的潛力股評分（總分及評等）
- 各維度得分：成長潛力、獲利能力、穩定性、估值合理性、配息穩定性
- 分析日期記錄

## 🚀 使用方法

### 方法1: 命令列執行（推薦）
```bash
# Windows (使用cmd)
python generate_stock_report.py 2330

# macOS/Linux
python3 generate_stock_report.py 2330

# 其他範例
python generate_stock_report.py 0050  # 元大台灣50
python generate_stock_report.py 2454  # 聯發科
```

### 方法2: VSCode終端執行
在VSCode終端中直接輸入：
```bash
python generate_stock_report.py [股票代號]
```

### 方法3: 互動式執行
如果遇到PowerShell執行政策問題，可以：
1. 開啟命令提示字元(cmd)
2. 切換到專案目錄：`cd g:\WorkFolder\taiwan-stock-system`
3. 執行：`python generate_stock_report.py [股票代號]`

## 📁 輸出格式

### 檔案命名
```
{股票代號}_{股票名稱}_財務分析報告_{日期}.xlsx
```

範例：
- `2330_台積電_財務分析報告_20250725.xlsx`
- `0050_元大台灣50_財務分析報告_20250725.xlsx`

### Excel格式特色
- ✅ 專業的表格格式（標題、顏色、邊框）
- ✅ 數字千分位符號格式化
- ✅ 百分比自動加%符號
- ✅ 自動調整欄寬
- ✅ 清晰的工作表分類

## 🔧 系統需求

### 必要套件
```bash
pip install openpyxl pandas numpy
```

### 支援平台
- ✅ **Windows 10/11**: 完全支援
- ✅ **macOS**: 完全支援，無編碼問題
- ✅ **Linux**: 完全支援

## 🖥️ Mac兼容性確認

### ✅ 完全支援macOS
1. **編碼支援**: 使用UTF-8編碼，無cp950問題
2. **檔案路徑**: 自動處理不同作業系統的路徑格式
3. **Excel格式**: openpyxl套件跨平台支援
4. **中文顯示**: 完美支援繁體中文

### macOS執行範例
```bash
# 安裝依賴
pip3 install openpyxl pandas numpy

# 執行報告生成
python3 generate_stock_report.py 2330

# 檢查生成的檔案
ls -la *.xlsx
```

## ❌ 錯誤處理

### 常見錯誤及解決方案

1. **股票代號不存在**
   ```
   錯誤: 股票代號 XXXX 不存在於資料庫中
   ```
   解決：檢查股票代號是否正確，確認資料庫中有該股票資料

2. **缺少openpyxl套件**
   ```
   錯誤: 需要安裝 openpyxl 套件
   ```
   解決：執行 `pip install openpyxl`

3. **無資料顯示**
   - 如果某些欄位顯示"無資料"，表示資料庫中該股票的對應資料尚未收集
   - 可以先執行資料收集腳本補充資料

4. **PowerShell執行政策問題（僅Windows）**
   - 使用cmd而非PowerShell
   - 或在VSCode終端中執行

## 📊 資料來源說明

所有資料都來自現有的SQLite資料庫，包括：
- `stocks` - 股票基本資料
- `stock_prices` - 股價資料
- `monthly_revenues` - 月營收資料
- `financial_statements` - 綜合損益表
- `balance_sheets` - 資產負債表
- `dividend_policies` - 股利政策
- `financial_ratios` - 財務比率
- `stock_scores` - 潛力股評分

## 🎉 使用範例

```bash
# 生成台積電報告
python generate_stock_report.py 2330

# 輸出結果
✅ 報告生成成功: 2330_台積電_財務分析報告_20250725.xlsx
📊 包含工作表: 基本資訊、月營收、季度財務、年度財務、股利政策、潛力分析

🎉 財務分析報告生成完成！
📋 報告內容包括:
   • 基本資訊 (股票代號、名稱、市場、最新股價等)
   • 月營收 (近24個月營收及成長率)
   • 季度財務 (近8季損益表資料)
   • 年度財務 (近5年財務比率及資產負債)
   • 股利政策 (近5年配息配股記錄)
   • 潛力分析 (系統評分及各維度分析)

💡 Mac兼容性: 此腳本完全支援macOS，無編碼問題
```

## 💡 提示

1. **建議先檢查資料庫狀態**：
   ```bash
   python check_db_status.py
   ```

2. **如果資料不足，可先收集資料**：
   ```bash
   python scripts/collect_all_10years.py --batch-size 3
   ```

3. **支援的股票代號格式**：
   - 上市股票：2330、2454、2317等
   - 上櫃股票：6488、3443等
   - ETF：0050、0056等

---

*此工具完全支援跨平台使用，特別針對Mac進行了兼容性優化*
