# 目標變數 (Target Variable) 說明

## 🎯 什麼是目標變數？

目標變數是機器學習模型要預測的「正確答案」。在潛力股預測系統中，目標變數定義了什麼是「潛力股」。

## 📊 我們的目標變數定義

### **預測目標**
- 股票在未來 **20個交易日** 內是否會上漲超過 **5%**

### **標籤定義**
- **1 (看漲)**: 20日內漲幅 ≥ 5%
- **0 (看跌)**: 20日內漲幅 < 5%

## 🔍 具體例子

### 例子1: 台積電 (2330)
```
特徵日期: 2024-01-15
當日收盤價: 500元

20個交易日後 (2024-02-15):
收盤價: 530元
漲幅: (530-500)/500 = 6%

結果: 6% > 5% → 目標變數 = 1 (看漲)
```

### 例子2: 聯發科 (2454)
```
特徵日期: 2024-01-15  
當日收盤價: 800元

20個交易日後 (2024-02-15):
收盤價: 820元
漲幅: (820-800)/800 = 2.5%

結果: 2.5% < 5% → 目標變數 = 0 (看跌)
```

## 🏗️ 目標變數生成流程

### 1. 選擇時間範圍
- **開始日期**: 例如 2022-01-01
- **結束日期**: 例如 2024-06-30
- **頻率**: monthly (每月) 或 quarterly (每季)

### 2. 生成特徵日期
- **monthly**: 每月最後一個交易日
- **quarterly**: 每季最後一個交易日

### 3. 計算未來漲幅
對每個特徵日期：
1. 取得當日收盤價
2. 找到20個交易日後的收盤價
3. 計算漲幅百分比
4. 判斷是否 ≥ 5%

### 4. 生成標籤
- 漲幅 ≥ 5% → 標籤 = 1
- 漲幅 < 5% → 標籤 = 0

## 📁 輸出檔案格式

生成的目標變數檔案包含：

```csv
stock_id,feature_date,target_date,start_price,end_price,return_pct,target
2330,2024-01-31,2024-02-28,500.0,530.0,6.0,1
2454,2024-01-31,2024-02-28,800.0,820.0,2.5,0
1301,2024-01-31,2024-02-28,45.0,48.0,6.67,1
```

## 🎯 為什麼需要目標變數？

### 1. **訓練模型**
- 機器學習需要「正確答案」來學習
- 模型學習特徵和結果之間的關係

### 2. **評估準確性**
- 比較模型預測和實際結果
- 計算準確率、精確率、召回率

### 3. **歷史回測**
- 驗證策略在過去的表現
- 調整模型參數

## ⚙️ 使用方式

### 透過選單系統
```
選擇 2 (資料處理)
選擇 3 (生成目標變數)
輸入開始日期: 2022-01-01
輸入結束日期: 2024-06-30
輸入頻率: quarterly
```

### 直接命令
```bash
python main.py generate-targets --start-date 2022-01-01 --end-date 2024-06-30 --frequency quarterly
```

## 📈 實際應用

### 模型訓練流程
1. **生成特徵** → 每個日期的技術指標、財務數據
2. **生成目標變數** → 每個日期的未來漲跌標籤  
3. **訓練模型** → 學習特徵和標籤的關係
4. **預測未來** → 用當前特徵預測未來漲跌

### 投資策略
- 模型預測 = 1 → 考慮買入
- 模型預測 = 0 → 考慮賣出或觀望
- 預測機率 > 0.7 → 高信心度
- 預測機率 < 0.3 → 高信心度 (反向)

## 🔧 技術細節

### 交易日計算
- 排除週末和國定假日
- 使用實際交易日曆
- 確保20個交易日的準確性

### 資料品質
- 處理股票分割、除權除息
- 過濾異常價格資料
- 確保資料完整性

## 💡 注意事項

1. **未來函數**: 目標變數使用未來資料，只能用於訓練，不能用於實際預測
2. **生存偏差**: 已下市股票可能影響結果
3. **市場環境**: 不同時期的市場環境會影響模型效果
4. **風險提醒**: 預測結果僅供參考，投資有風險

---

這個目標變數系統幫助我們建立一個客觀、量化的「潛力股」定義，讓機器學習模型能夠學習和預測股票的未來表現。
