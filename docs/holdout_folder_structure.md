# 選單5外層回測 - 參數化資料夾結構

## 概述

選單5（外層回測）現在會根據回測參數自動創建專屬的資料夾，讓不同參數設定的結果能夠清楚分離和比較。

## 資料夾命名規則

### 格式
```
holdout_{開始月}_{結束月}_{門檻}_{TopK}_{市場濾網}_{時間戳}
```

### 參數說明

| 參數 | 格式 | 說明 | 範例 |
|------|------|------|------|
| 開始月 | YYYYMM | 回測開始月份 | 202301 |
| 結束月 | YYYYMM | 回測結束月份 | 202312 |
| 門檻 | 3位數字 | 最小預測報酬門檻 × 1000 | 020 (0.02) |
| TopK | k數字 或 kAll | 每月最多持股數 | k10, kAll |
| 市場濾網 | MF 或 NoMF | 是否啟用市場濾網 | MF, NoMF |
| 時間戳 | MMDDHHMMSS | 執行時間（月日時分秒） | 0826161320 |

### 範例

| 參數設定 | 資料夾名稱 |
|----------|------------|
| 期間: 2023-01~2023-12<br>門檻: 2%<br>TopK: 10<br>市場濾網: 是<br>執行時間: 8/26 16:13:20 | `holdout_202301_202312_020_k10_MF_0826161320` |
| 期間: 2024-06~2024-08<br>門檻: 1.5%<br>TopK: 5<br>市場濾網: 否<br>執行時間: 8/26 16:13:21 | `holdout_202406_202408_015_k5_NoMF_0826161321` |
| 期間: 2023-03~2023-05<br>門檻: 3%<br>TopK: 不限制<br>市場濾網: 是<br>執行時間: 8/26 16:13:22 | `holdout_202303_202305_030_kAll_MF_0826161322` |

## 資料夾結構

每個參數化資料夾包含以下檔案：

```
results/holdout/holdout_202301_202312_020_k10_MF_0826161320/
├── holdout_20241226_143022.json          # 回測結果摘要
├── holdout_trades_20241226_143022.csv     # 詳細交易記錄
├── holdout_monthly_20241226_143022_202301.csv  # 2023年1月結果
├── holdout_monthly_20241226_143022_202302.csv  # 2023年2月結果
├── ...
└── charts/                               # 回測圖表
    ├── cumulative_returns.html
    ├── monthly_performance.html
    └── ...
```

## 檔案說明

### 1. holdout_*.json
- 回測結果摘要
- 包含總體績效指標、參數設定、月度統計

### 2. holdout_trades_*.csv
- 詳細交易記錄
- 包含每筆交易的進出場價位、報酬率、20日最大/最小報酬

### 3. holdout_monthly_*.csv
- 逐月詳細結果
- 每月一個檔案，包含該月所有交易的詳細資訊

### 4. charts/
- 互動式回測圖表
- 累積報酬、月度績效、風險指標等視覺化

## 優點

1. **清楚分離**: 不同參數設定的結果不會混淆
2. **易於比較**: 可以同時保留多組參數的結果進行比較
3. **參數追溯**: 從資料夾名稱就能知道使用的參數
4. **時間追溯**: 從時間戳可以知道確切的執行時間
5. **避免覆蓋**: 每次執行都有唯一的時間戳，不會覆蓋之前的結果
6. **組織性**: 結果檔案有序組織，便於管理
7. **歷史保存**: 可以保留歷史回測結果作為參考

## 使用建議

1. **參數實驗**: 嘗試不同參數組合時，每組結果都會保存在獨立資料夾
2. **重複執行**: 相同參數的多次執行會產生不同時間戳的資料夾，便於比較穩定性
3. **績效比較**: 可以同時查看多個資料夾的結果進行比較
4. **報告製作**: 資料夾名稱可直接用於報告中的參數說明
5. **清理管理**: 定期清理不需要的舊結果資料夾

## 注意事項

- 資料夾會自動創建，無需手動建立
- 每次執行都會產生新的時間戳資料夾，不會覆蓋之前的結果
- 時間戳格式為 MMDDHHMMSS（月日時分秒），確保唯一性
- 建議定期備份重要的回測結果
- 資料夾名稱使用英文和數字，確保跨平台兼容性
- 長時間使用後可能累積大量資料夾，建議定期清理不需要的結果
